<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title></title>
<style>
/* Modern Dark Mode UI */
:root {
--ui-bg: #121416;
--ui-card: #1c1f22;
--accent: #00a8ff;
--text-main: #e0e0e0;
--gray-bg: #f0f0f0; /* F√ºr das Druckdokument */
}

* { box-sizing: border-box; }
body { font-family: 'Segoe UI', Arial, sans-serif; background: var(--ui-bg); color: var(--text-main); margin: 0; padding: 20px; }

/* Das Dokument auf dem Bildschirm (Vorschau) */
.container {
max-width: 900px; margin: auto; background: white; color: black;
padding: 45px; min-height: 297mm; display: flex; flex-direction: column;
box-shadow: 0 10px 30px rgba(0,0,0,0.5); border-radius: 4px;
}

/* Toolbar Styles */
.no-print { display: flex; gap: 12px; justify-content: center; margin-bottom: 25px; background: var(--ui-card); padding: 15px; border-radius: 10px; border: 1px solid #333; }
button { padding: 10px 18px; border-radius: 6px; border: none; cursor: pointer; font-weight: bold; background: var(--accent); color: white; transition: 0.2s; }
button:hover { filter: brightness(1.1); transform: translateY(-1px); }
.btn-del { background: #ff4757; padding: 4px 8px; font-size: 11px; }

/* Header Dokument */
.header-main { display: grid; grid-template-columns: 1fr 1fr 1fr; margin-bottom: 35px; }
.addr-left { font-size: 12px; line-height: 1.3; }
.addr-left h2 { margin: 0 0 5px 0; font-size: 26px; letter-spacing: 2px; color: black; }
.title-center { text-align: center; font-size: 30px; font-weight: bold; text-decoration: underline; text-transform: uppercase; }
.logo-right { text-align: right; }
.logo-img { font-size: 40px; font-weight: bold; letter-spacing: -2px; line-height: 1; margin-bottom: 10px; }
.logo-img span { transform: scaleX(-1); display: inline-block; }

.meta-box { background: var(--gray-bg); padding: 10px; border-radius: 4px; width: 270px; margin-left: auto; font-size: 12px; border: 1px solid #ddd; }
.meta-row { display: flex; justify-content: space-between; margin-bottom: 4px; align-items: center; }
.meta-row input { background: transparent; border: none; text-align: right; width: 130px; font-weight: bold; font-family: inherit; color: black; }
.small-note { font-size: 10px; text-align: right; margin-top: 5px; font-style: italic; color: #666; }

/* Empf√§nger */
.recipient { margin: 30px 0; width: 380px; }
.recipient strong { text-decoration: underline; display: block; margin-bottom: 10px; font-size: 15px; }
.recipient input { display: block; width: 100%; border: none; border-bottom: 1px solid #eee; padding: 5px 0; font-size: 14px; margin-bottom: 3px; }

/* Tabelle */
table { width: 100%; border-collapse: collapse; margin: 25px 0; }
th { border: 1px solid #000; padding: 10px; background: #f2f2f2; font-size: 13px; text-align: left; }
td { border: 1px solid #000; padding: 8px; position: relative; }
.table-input { width: 100%; border: none; font-size: 13px; background: transparent; color: black; }

/* Footer */
.footer-text-block { margin-top: auto; font-size: 11.5px; line-height: 1.6; color: #333; }
.bottom-line { border-top: 1.5px solid #000; padding-top: 12px; display: grid; grid-template-columns: 1.2fr 1fr 1fr 1.1fr; gap: 15px; font-size: 9.5px; margin-top: 15px; }

.summary-area { text-align: right; margin: 20px 0; }
.total-box { font-size: 20px; font-weight: bold; border-bottom: 2px solid #000; padding: 4px 8px; }

/* DRUCK OPTIMIERUNG */
@media print {
@page { size: A4; margin: 0; }
body { background: white; padding: 1.5cm; }
.container { box-shadow: none; min-height: auto; padding: 0; width: 100%; border-radius: 0; }
.no-print, .btn-del { display: none !important; }
input { border: none !important; color: black !important; }
.tel-input:placeholder-shown { display: none !important; }
.meta-box { -webkit-print-color-adjust: exact; background-color: var(--gray-bg) !important; border: 1px solid #ccc !important; }
th { background-color: #f2f2f2 !important; -webkit-print-color-adjust: exact; }
.total-box { color: black !important; }
}
</style>
</head>
<body>

<div class="no-print">
<button onclick="saveAndPrint()" style="background: #27ae60;">üñ®Ô∏è DRUCKEN & SPEICHERN</button>
<button onclick="sendMail()" style="background: #e67e22;">üìß PER E-MAIL SENDEN</button>
<button onclick="addItem()" style="background: #2ecc71;">+ POSITION</button>
<button onclick="saveProduct()" style="background: #34495e;">üíæ PRODUKTE SPEICHERN</button>
<button onclick="toggleType()" id="typeBtn" style="background: #9b59b6;">ZU ANGEBOT</button>
</div>

<div class="container" id="invoiceWrap">
<div class="header-main">
<div class="addr-left">
<h2>D3D</h2>
Graf-Sempt-Str. 27, 85661 Forstinning<br>Deutschland
</div>
<div class="title-center" id="docType">Rechnung</div>
<div class="logo-right">
<div class="logo-img"><span>D</span>3D</div>
<div class="meta-box">
<div class="meta-row"><span>Datum:</span><input type="text" id="date"></div>
<div id="invMeta">
<div class="meta-row"><span>Rechnungsnr.:</span><input type="text" id="invNum" value="J012601"></div>
<div class="meta-row"><span>Zahlungsziel (Tage):</span><input type="number" id="dueDays" value="14" oninput="calcDate()"></div>
<div class="meta-row"><span>F√§llig am:</span><input type="text" id="dueDate" readonly></div>
</div>
<div class="small-note" id="invNote">(Rechnungsnummer bei Zahlung bitte angeben)</div>
</div>
</div>
</div>

<div class="recipient">
<strong>Empf√§nger:</strong>
<input type="text" id="rec-name" placeholder="Vorname Nachname">
<input type="text" placeholder="Stra√üe Hausnummer">
<input type="text" placeholder="PLZ Ort">
<input type="text" class="tel-input" placeholder="Handynummer (optional)">
</div>

<p style="font-size: 13px; margin: 0;" id="introText">Wir danken f√ºr Ihren Auftrag und berechnen diesen wie folgt:</p>

<table>
<thead>
<tr>
<th style="width:5%">Pos.</th>
<th style="width:45%">Bezeichnung</th>
<th style="width:10%">Anzahl</th>
<th style="width:10%">Einheit</th>
<th style="width:15%">Preis (‚Ç¨)</th>
<th style="width:15%">Gesamt</th>
</tr>
</thead>
<tbody id="itemsBody"></tbody>
</table>

<div class="summary-area">
<div class="no-print" style="margin-bottom: 10px;">
<select id="statusSelect" onchange="updateStatus()" style="padding: 5px; background: #333; color: white; border: none; border-radius: 4px;">
<option value="">Zahlstatus w√§hlen...</option>
<option value="Betrag in bar erhalten">Betrag in bar erhalten</option>
<option value="Betrag dankend erhalten">Betrag dankend erhalten</option>
<option value="Offen">Offen</option>
</select>
</div>
<div class="total-box">Rechnungsbetrag: <span id="grandTotal">0.00</span> ‚Ç¨</div><br>
<div id="statusLabel" style="font-weight: bold; margin-top: 8px; font-size: 15px; color: #00a8ff;"></div>
</div>

<div class="footer-text-block">
<div class="legal">
Die gelieferte Ware bleibt bis zur vollst√§ndigen Bezahlung Eigentum von D3D.<br>
Kein Steuerausweis aufgrund der Anwendung der Kleinunternehmerregelung (¬ß 19 UStG).<br>
Personalisierte und individuell angefertigte Waren sind vom Umtausch ausgeschlossen (¬ß312 Abs. 2 Nr. 1 BGB).
</div>
<div class="bottom-line">
<div><strong>D3D</strong><br>Graf-Sempt-Str. 27<br>85661 Forstinning<br>Deutschland</div>
<div><strong>Kontaktinformationen</strong><br>E-Mail: kontakt.D3D@gmail.com<br>GF: Strzoda Dominic</div>
<div><strong>Steuerinformationen</strong><br>St-Nr: 112/279/00204<br>Ust-IdNr: DE455897359-00001</div>
<div><strong>Bankinformationen</strong><br>IBAN: DE65100110012856642824<br>BIC: NTSBDEB1XXX</div>
</div>
</div>
</div>

<datalist id="prodList"></datalist>

<script>
let products = JSON.parse(localStorage.getItem('d3d_prods')) || ["Akkuhalter f√ºr Makita"];
let isInvoice = true;

function init() {
document.getElementById('date').value = new Date().toLocaleDateString('de-DE');

// Letzte Rechnungsnummer laden
const lastNum = localStorage.getItem('d3d_last_inv');
if(lastNum) {
document.getElementById('invNum').value = incrementInvNum(lastNum);
}

updateDatalist();
calcDate();
addItem();
}

function incrementInvNum(oldNum) {
// Findet die letzte Zahlengruppe in der Nummer (z.B. die 001 in J0126-001)
return oldNum.replace(/(\d+)(?!.*\d)/, (match) => {
let next = parseInt(match) + 1;
return next.toString().padStart(match.length, '0');
});
}

function saveAndPrint() {
// Rechnungsnummer f√ºr das n√§chste Mal speichern
localStorage.setItem('d3d_last_inv', document.getElementById('invNum').value);
window.print();
}

function updateDatalist() {
document.getElementById('prodList').innerHTML = products.map(p => `<option value="${p}">`).join('');
}

function addItem() {
const body = document.getElementById('itemsBody');
const row = body.insertRow();
row.innerHTML = `
<td style="text-align:center">${body.rows.length}</td>
<td><input class="table-input prod-name" list="prodList" placeholder="Bezeichnung..."></td>
<td><input type="number" class="table-input" value="1" oninput="calc()"></td>
<td><input class="table-input" value="St√ºck"></td>
<td><input type="number" class="table-input" value="0.00" step="0.01" oninput="calc()"></td>
<td style="font-weight:bold"><span class="row-total">0.00</span>
<button class="btn-del no-print" onclick="this.parentElement.parentElement.remove(); calc();" style="position:absolute; right: -35px; top: 6px;">X</button>
</td>
`;
}

function calc() {
let total = 0;
const rows = document.getElementById('itemsBody').rows;
for (let i = 0; i < rows.length; i++) {
rows[i].cells[0].innerText = i + 1;
const q = rows[i].cells[2].querySelector('input').value;
const p = rows[i].cells[4].querySelector('input').value;
const sub = q * p;
rows[i].querySelector('.row-total').innerText = sub.toFixed(2);
total += sub;
}
document.getElementById('grandTotal').innerText = total.toFixed(2);
}

function calcDate() {
const daysInput = document.getElementById('dueDays').value;
const days = parseInt(daysInput);

if (daysInput === "" || days === 0) {
document.getElementById('dueDate').value = document.getElementById('date').value;
return;
}

const d = new Date();
d.setDate(d.getDate() + days);
document.getElementById('dueDate').value = d.toLocaleDateString('de-DE');
}

function saveProduct() {
const names = document.querySelectorAll('.prod-name');
names.forEach(n => { if(n.value && !products.includes(n.value)) products.push(n.value); });
localStorage.setItem('d3d_prods', JSON.stringify(products));
updateDatalist();
alert("Produkte in Liste gespeichert!");
}

function sendMail() {
const name = document.getElementById('rec-name').value || "Kunde";
const nr = document.getElementById('invNum').value;
const subject = encodeURIComponent(`Rechnung ${nr} - D3D`);
const body = encodeURIComponent(`Hallo ${name},\n\nanbei erhalten Sie die Rechnung ${nr}.\n\nBeste Gr√º√üe,\nD3D`);
window.location.href = `mailto:?subject=${subject}&body=${body}`;
}

function toggleType() {
isInvoice = !isInvoice;
document.getElementById('docType').innerText = isInvoice ? "Rechnung" : "Angebot";
document.getElementById('typeBtn').innerText = isInvoice ? "ZU ANGEBOT" : "ZU RECHNUNG";
document.getElementById('invMeta').style.display = isInvoice ? "block" : "none";
document.getElementById('invNote').style.display = isInvoice ? "block" : "none";
document.getElementById('introText').innerText = isInvoice ? "Wir danken f√ºr Ihren Auftrag und berechnen diesen wie folgt:" : "Gerne unterbreiten wir Ihnen folgendes Angebot:";
}

function updateStatus() {
document.getElementById('statusLabel').innerText = document.getElementById('statusSelect').value;
}

init();
</script>
</body>
</html>
