<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>D3D Rechnungs-Tool PRO</title>
<style>
:root {
--ui-bg: #121416;
--ui-card: #1c1f22;
--accent: #00a8ff;
--text-main: #e0e0e0;
--doc-white: #ffffff;
}

* { box-sizing: border-box; }
body { font-family: 'Segoe UI', Arial, sans-serif; background: var(--ui-bg); color: var(--text-main); margin: 0; padding: 10px; }

/* Handy-Ansicht Optimierung */
.no-print {
display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 10px;
max-width: 900px; margin: 0 auto 15px auto; background: var(--ui-card);
padding: 15px; border-radius: 10px;
}
.no-print button {
width: 100%; padding: 12px; border-radius: 6px; border: none;
cursor: pointer; font-weight: bold; color: white; font-size: 11px; transition: 0.2s;
}

.import-area { grid-column: 1 / -1; display: flex; flex-direction: column; gap: 10px; background: rgba(255,255,255,0.05); padding: 10px; border-radius: 6px; }
.import-area textarea { width: 100%; height: 60px; background: #2c3135; color: white; border: none; padding: 8px; border-radius: 4px; font-size: 11px; resize: none; }

.shipping-manager { grid-column: 1 / -1; background: rgba(255,255,255,0.05); padding: 15px; border-radius: 6px; display: flex; flex-direction: column; gap: 8px; }

.container {
max-width: 900px; margin: auto; background: var(--doc-white); color: black;
padding: 30px 45px; min-height: 297mm; display: flex; flex-direction: column;
box-shadow: 0 10px 30px rgba(0,0,0,0.5); position: relative;
}

/* Versandetikett Styling */
#labelWrap {
width: 148mm; height: 105mm; /* DIN A6 */
background: white; color: black; border: 2px solid #000;
margin: 20px auto; padding: 10mm; display: none; /* Nur beim Druck sichtbar */
position: relative; font-family: Arial, sans-serif;
}
.label-sender { font-size: 12px; position: absolute; top: 10mm; left: 10mm; border-bottom: 1px solid #000; padding-bottom: 5px; }
.label-receiver { font-size: 18px; position: absolute; top: 40mm; left: 50mm; font-weight: bold; }

/* Desktop/Rechnung CSS wie gehabt */
.header-main { display: flex; justify-content: space-between; margin-bottom: 15px; align-items: start; }
.addr-left { font-size: 11px; line-height: 1.2; padding-top: 15px; }
.title-center { text-align: center; font-size: 26px; font-weight: bold; text-decoration: underline; text-transform: uppercase; margin-top: 15px; }
.logo-text { font-size: 42px; font-weight: bold; letter-spacing: -2px; text-align: center; }
.logo-text span { transform: scaleX(-1); display: inline-block; }

.meta-box { background: #f0f0f0 !important; padding: 10px; border-radius: 4px; width: 260px; font-size: 11px; border: 1px solid #ddd; }
.meta-row { display: flex; justify-content: space-between; margin-bottom: 3px; }
.meta-row input { background: transparent; border: none; text-align: right; width: 110px; font-weight: bold; color: black; font-size: 11px; }
.meta-hint { font-size: 9px; color: #555; text-align: center; display: block; margin-top: 5px; font-style: italic; }

.recipient { margin: 5px 0 15px 0; width: 350px; }
.recipient input { display: block; width: 100%; border: none; padding: 2px 0; font-size: 13px; color: black; background: transparent; outline: none; }

table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
th { border: 1px solid #000; padding: 6px; background: #f2f2f2; font-size: 12px; text-align: left; }
td { border: 1px solid #000; padding: 4px; position: relative; }
.table-input { width: 100%; border: none; font-size: 12px; background: transparent; color: black; outline: none; }

.row-btns { position: absolute; right: -65px; top: 50%; transform: translateY(-50%); display: flex; gap: 8px; }
.btn-action { width: 26px; height: 26px; border-radius: 6px; border: none; cursor: pointer; color: white; font-weight: bold; }

.summary-area { text-align: right; margin: 10px 0; display: flex; flex-direction: column; align-items: flex-end; }
.total-box { font-size: 18px; font-weight: bold; border-bottom: 2px solid #000; padding: 2px 5px; }

.bottom-line { border-top: 1.5px solid #000; padding-top: 10px; display: grid; grid-template-columns: 1.2fr 1fr 1fr 1.1fr; gap: 10px; font-size: 9px; }

@media print {
@page { size: A4; margin: 0; }
body { background: white; padding: 0; }
.no-print, .row-btns { display: none !important; }
.container { box-shadow: none; border: none; transform: scale(0.9); transform-origin: top center; page-break-after: always; }
#labelWrap { display: block; page-break-before: always; margin-top: 0; }
}

@media screen and (max-width: 600px) {
.container { padding: 15px; }
.header-main { flex-direction: column; align-items: center; }
.meta-box { width: 100%; margin-top: 10px; }
.recipient { width: 100%; }
}
</style>
</head>
<body>

<div class="no-print">
<button onclick="saveAndPrint()" style="background: #27ae60;">üñ®Ô∏è DRUCKEN</button>
<button onclick="sendMail()" style="background: #2980b9;">üìß PER E-MAIL SENDEN</button>
<button onclick="toggleType()" id="typeBtn" style="background: #8e44ad;">ZU ANGEBOT</button>
<button onclick="saveProduct()" style="background: #f39c12;">üíæ PRODUKT SPEICHERN</button>
<button onclick="manageProducts()" style="background: #c0392b;">üóëÔ∏è PRODUKT L√ñSCHEN</button>
<button onclick="addItem()" style="background: #2ecc71;">+ POSITION</button>

<div class="import-area">
<textarea id="adrImport" placeholder="-Adresse hier einf√ºgen-"></textarea>
<button onclick="importAddress()" style="background: #00a8ff;">ADRESSE IMPORTIEREN</button>
</div>
<div class="shipping-manager" id="shipManager"></div>
</div>

<div class="container" id="invoiceWrap">
<div class="header-main">
<div class="addr-left">
<h2>D3D</h2>
Graf-Sempt-Str. 27, 85661 Forstinning<br>Deutschland
</div>
<div class="title-center" id="docType">Rechnung</div>
<div class="logo-column">
<div class="logo-text"><span>D</span>3D</div>
<div class="meta-box">
<div class="meta-row"><span>Datum:</span><input type="text" id="date"></div>
<div class="meta-row"><span>Rechnungsnr.:</span><input type="text" id="invNum" value="J012601"></div>
<div class="meta-row"><span>Ziel (Tage):</span><input type="number" id="dueDays" value="14" oninput="updateDueDate()"></div>
<div class="meta-row"><span>F√§llig am:</span><input type="text" id="dueDate" readonly></div>
<span class="meta-hint">(Rechnungsnummer bei Zahlung bitte angeben)</span>
</div>
</div>
</div>

<div class="recipient">
<strong>Empf√§nger:</strong>
<input type="text" id="rec-name" placeholder="Name">
<input type="text" id="rec-street" placeholder="Stra√üe Hausnummer">
<input type="text" id="rec-city" placeholder="PLZ Ort">
<input type="text" id="rec-country" placeholder="Land">
<input type="text" id="rec-tel" placeholder="Tel.-Nr.">
</div>

<p style="font-size: 12px; margin: 15px 0 10px 0;" id="introText">Wir danken f√ºr Ihren Auftrag und berechnen diesen wie folgt:</p>

<table>
<thead>
<tr>
<th style="width:5%">Pos.</th>
<th style="width:45%">Bezeichnung</th>
<th style="width:10%">Anzahl</th>
<th style="width:10%">Einheit</th>
<th style="width:15%">Preis (‚Ç¨)</th>
<th style="width:15%">Gesamt (‚Ç¨)</th>
</tr>
</thead>
<tbody id="itemsBody"></tbody>
</table>

<div class="summary-area">
<div class="total-box">Gesamtbetrag: <span id="grandTotal">0.00</span> ‚Ç¨</div>
<div id="statusSection">
<select id="statusSelect" class="no-print" onchange="updateStatus()">
<option value="">Zahlungshinweis</option>
<option value="Betrag in bar erhalten">Betrag in bar erhalten</option>
<option value="Betrag dankend erhalten">Betrag dankend erhalten</option>
<option value="Offen">Offen</option>
</select>
<div id="statusLabel"></div>
</div>
</div>

<div class="footer-wrap">
<div class="legal">
Die gelieferte Ware bleibt bis zur vollst√§ndigen Bezahlung Eigentum von D3D. Kein Steuerausweis (¬ß19 UStG). Personalisierte Waren sind vom Umtausch ausgeschlossen.
</div>
<div class="bottom-line">
<div><strong>D3D</strong><br>Graf-Sempt-Str. 27<br>85661 Forstinning</div>
<div><strong>Kontakt</strong><br>kontakt.D3D@gmail.com</div>
<div><strong>Steuer</strong><br>St-Nr: 112/279/00204</div>
<div><strong>Bank</strong><br>IBAN: DE65 1001 1001 2856 6428 24</div>
</div>
</div>
</div>

<div id="labelWrap">
<div class="label-sender">
Absender: D3D Dominic Strzoda, Graf-Sempt-Str. 27, 85661 Forstinning, DE
</div>
<div class="label-receiver" id="lblRec">
</div>
</div>

<datalist id="prodList"></datalist>

<script>
// Initialisierung & Datalist
let products = JSON.parse(localStorage.getItem('d3d_prods')) || ["Akkuhalter"];
let shippingOptions = JSON.parse(localStorage.getItem('d3d_shipping')) || [
{name: "Versand (DHL Paket)", price: 5.49},
{name: "Versand (Gro√übrief)", price: 2.25}
];

function init() {
document.getElementById('date').value = new Date().toLocaleDateString('de-DE');
updateDueDate();
updateDatalist();
renderShippingManager();
for(let i=0; i<3; i++) addItem();
}

function renderShippingManager() {
const container = document.getElementById('shipManager');
container.innerHTML = '<h4 style="margin:0 0 5px 0; color:var(--accent)">Versand-Optionen</h4>';
shippingOptions.forEach((opt, index) => {
const row = document.createElement('div');
row.className = 'ship-row';
row.style = "display:flex; gap:10px; align-items:center; background:#2c3135; padding:8px; border-radius:6px; margin-bottom:5px;";
row.innerHTML = `<div style="flex:1; font-size:12px; color:white; font-weight:bold;">${opt.name} (${opt.price.toFixed(2)} ‚Ç¨)</div>
<button onclick="addShipping(${index})" style="background:#00a8ff; color:white; border:none; padding:5px 10px; border-radius:4px; cursor:pointer;">+</button>`;
container.appendChild(row);
});
}

function addShipping(index) { addItem(shippingOptions[index].name, shippingOptions[index].price.toFixed(2)); }

function addItem(name = "", price = "") {
const body = document.getElementById('itemsBody');
const row = body.insertRow();
row.innerHTML = `
<td style="text-align:center">${body.rows.length}</td>
<td><input class="table-input prod-name" list="prodList" value="${name}" oninput="toggleAutoFields(this)"></td>
<td><input type="number" class="table-input qty-field" value="" oninput="calc()" style="visibility: hidden;"></td>
<td><input class="table-input unit-field" value="" style="visibility: hidden;"></td>
<td><input type="number" class="table-input price-field" value="${price}" step="0.01" onblur="formatPrice(this)" oninput="calc()"></td>
<td style="font-weight:bold"><span class="row-total"></span>
<div class="row-btns no-print">
<button class="btn-action" style="background:#2ecc71" onclick="markPers(this)">‚úì</button>
<button class="btn-action" style="background:#ff4757" onclick="this.closest('tr').remove(); calc();">‚úï</button>
</div>
</td>`;
if(name !== "") toggleAutoFields(row.querySelector('.prod-name'));
calc();
}

function calc() {
let total = 0;
const rows = document.getElementById('itemsBody').rows;
for (let i = 0; i < rows.length; i++) {
rows[i].cells[0].innerText = i + 1;
const q = rows[i].querySelector('.qty-field').value || 0;
const p = rows[i].querySelector('.price-field').value || 0;
const sub = q * p;
rows[i].querySelector('.row-total').innerText = sub > 0 ? sub.toFixed(2) : "";
total += parseFloat(sub);
}
document.getElementById('grandTotal').innerText = total.toFixed(2);
}

function importAddress() {
const raw = document.getElementById('adrImport').value;
const lines = raw.split('\n').map(l => l.trim()).filter(l => l.length > 0);
if(lines.length >= 3) {
document.getElementById('rec-name').value = lines[0];
document.getElementById('rec-street').value = lines[1];
document.getElementById('rec-city').value = lines[2];
document.getElementById('rec-country').value = lines[3] || "Deutschland";
if(lines[4]) document.getElementById('rec-tel').value = lines[4];
}
}

function saveAndPrint() {
// Empf√§nger f√ºr Etikett kopieren
const name = document.getElementById('rec-name').value;
const street = document.getElementById('rec-street').value;
const city = document.getElementById('rec-city').value;
const country = document.getElementById('rec-country').value;
document.getElementById('lblRec').innerHTML = `${name}<br>${street}<br>${city}<br>${country}`;
window.print();
}

function sendMail() {
const kunde = document.getElementById('rec-name').value || "Kunde";
const nr = document.getElementById('invNum').value;
const total = document.getElementById('grandTotal').innerText;

let artikelListe = "";
const rows = document.getElementById('itemsBody').rows;
for (let i = 0; i < rows.length; i++) {
const name = rows[i].querySelector('.prod-name').value;
const qty = rows[i].querySelector('.qty-field').value;
if(name) artikelListe += `- ${qty}x ${name}\n`;
}

const subject = encodeURIComponent(`Rechnung ${nr} - D3D`);
const body = encodeURIComponent(`Hallo ${kunde},\n\nanbei erhalten Sie die Rechnung ${nr}.\n\nPositionen:\n${artikelListe}\nGesamtbetrag: ${total} ‚Ç¨\n\nBeste Gr√º√üe,\nDominic Strzoda / D3D`);
window.location.href = `mailto:?subject=${subject}&body=${body}`;
}

// Restliche Funktionen (identisch zum Bestand)
function updateDueDate() {
const days = parseInt(document.getElementById('dueDays').value) || 0;
const d = new Date(); d.setDate(d.getDate() + days);
document.getElementById('dueDate').value = d.toLocaleDateString('de-DE');
}
function updateStatus() { document.getElementById('statusLabel').innerText = document.getElementById('statusSelect').value; }
function toggleAutoFields(input) {
const row = input.closest('tr');
const qty = row.querySelector('.qty-field');
const unit = row.querySelector('.unit-field');
if(input.value.trim() !== "") {
qty.style.visibility = "visible"; unit.style.visibility = "visible";
if(qty.value === "") qty.value = 1;
if(unit.value === "") unit.value = "St√ºck";
}
calc();
}
function formatPrice(input) {
let val = parseFloat(input.value.replace(',','.'));
if (!isNaN(val)) input.value = val.toFixed(2);
calc();
}
function toggleType() {
const type = document.getElementById('docType');
const intro = document.getElementById('introText');
const btn = document.getElementById('typeBtn');
if(type.innerText === "RECHNUNG") {
type.innerText = "ANGEBOT";
intro.innerText = "Gerne unterbreiten wir Ihnen folgendes Angebot:";
btn.innerText = "ZU RECHNUNG";
} else {
type.innerText = "RECHNUNG";
intro.innerText = "Wir danken f√ºr Ihren Auftrag und berechnen diesen wie folgt:";
btn.innerText = "ZU ANGEBOT";
}
}
function updateDatalist() { document.getElementById('prodList').innerHTML = products.map(p => `<option value="${p}">`).join(''); }
function saveProduct() {
const names = document.querySelectorAll('.prod-name');
names.forEach(n => { if(n.value && !products.includes(n.value)) products.push(n.value); });
localStorage.setItem('d3d_prods', JSON.stringify(products));
updateDatalist(); alert("Produkte gespeichert!");
}
function manageProducts() {
let toDelete = prompt("Produkt l√∂schen:\n" + products.join(", "));
if(toDelete) { products = products.filter(p => p !== toDelete); localStorage.setItem('d3d_prods', JSON.stringify(products)); updateDatalist(); }
}
function markPers(btn) {
const input = btn.closest('tr').querySelector('.prod-name');
if(!input.value.includes('(Personalisierte Anfertigung)')) {
input.value += " (Personalisierte Anfertigung)";
}
}

init();
</script>
</body>
</html>
