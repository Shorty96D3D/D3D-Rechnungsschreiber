<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>D3D Rechnungs-Tool PRO</title>
<style>
:root {
--ui-bg: #121416;
--ui-card: #1c1f22;
--accent: #00a8ff;
--text-main: #e0e0e0;
--doc-white: #ffffff;
}

* { box-sizing: border-box; }
body { font-family: 'Segoe UI', Arial, sans-serif; background: var(--ui-bg); color: var(--text-main); margin: 0; padding: 10px; }

.container {
max-width: 900px; margin: auto; background: var(--doc-white); color: black;
padding: 30px 45px; min-height: 297mm; display: flex; flex-direction: column;
box-shadow: 0 10px 30px rgba(0,0,0,0.5);
position: relative;
transition: padding 0.2s;
}

/* Toolbar */
.no-print {
display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;
max-width: 900px; margin: 0 auto 15px auto; background: var(--ui-card);
padding: 15px; border-radius: 10px;
}
.no-print button {
width: 100%; padding: 10px; border-radius: 6px; border: none;
cursor: pointer; font-weight: bold; color: white; font-size: 12px; transition: 0.2s;
}

.smart-paste-area {
grid-column: span 3; display: flex; gap: 10px; background: rgba(255,255,255,0.05);
padding: 10px; border-radius: 6px; margin-top: 5px; align-items: center;
}
.smart-paste-area textarea { flex: 1; height: 40px; border-radius: 4px; border: none; padding: 5px; font-size: 11px; background: #2c3135; color: white; resize: none; }

/* Header */
.header-main { display: grid; grid-template-columns: 1fr 1fr 1fr; margin-bottom: 15px; align-items: start; }
.addr-left { font-size: 11px; line-height: 1.2; padding-top: 15px; }
.addr-left h2 { margin: 0 0 3px 0; font-size: 22px; letter-spacing: 2px; }
.title-center { text-align: center; font-size: 26px; font-weight: bold; text-decoration: underline; text-transform: uppercase; margin-top: 15px; }

.logo-column { display: flex; flex-direction: column; align-items: center; }
.logo-placeholder { cursor: pointer; max-width: 200px; max-height: 100px; margin-bottom: 10px; display: flex; justify-content: center; align-items: center; }
.logo-img-upload { max-width: 100%; max-height: 80px; object-fit: contain; }

.meta-box { background: #f0f0f0; padding: 10px; border-radius: 4px; width: 260px; font-size: 11px; border: 1px solid #ddd; }
.meta-row { display: flex; justify-content: space-between; margin-bottom: 3px; }
.meta-row input { background: transparent; border: none; text-align: right; width: 120px; font-weight: bold; color: black; font-size: 11px; }

/* Empf√§nger */
.recipient { margin: 5px 0 15px 0; width: 350px; }
.recipient input { display: block; width: 100%; border: none; padding: 3px 0; font-size: 13px; margin-bottom: 1px; color: black; }

/* Tabelle */
table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
th { border: 1px solid #000; padding: 6px; background: #f2f2f2; font-size: 12px; text-align: left; }
td { border: 1px solid #000; padding: 4px; position: relative; }
.table-input { width: 100%; border: none; font-size: 12px; background: transparent; color: black; }

/* Interne Notizen (nur Screen) */
.internal-note { font-size: 9px; color: #888; border: none; background: #f9f9f9; width: 100%; margin-top: 2px; border-top: 1px dashed #ddd; }

/* Controls rechts */
.row-controls { position: absolute; right: -55px; top: 50%; transform: translateY(-50%); display: flex; gap: 5px; }
.btn-row { width: 20px; height: 20px; border: none; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 10px; color: white; }
.btn-del { background: #ff4757; }
.btn-check { background: #2ed573; }

/* Kompakt Modus */
.compact .container { padding: 15px 30px; min-height: auto; }
.compact table { margin-bottom: 10px; }
.compact .header-main { margin-bottom: 5px; }

/* Footer */
.footer-wrap { margin-top: auto; padding-top: 20px; }
.legal { font-size: 10.5px; line-height: 1.3; color: #333; margin-bottom: 10px; }
.bottom-line { border-top: 1.5px solid #000; padding-top: 10px; display: grid; grid-template-columns: 1.2fr 1fr 1fr 1.1fr; gap: 10px; font-size: 9px; }

@media print {
@page { size: A4; margin: 1cm; }
body { background: white; padding: 0; }
.no-print, .row-controls, .internal-note, #fileInput, #statusSelect { display: none !important; }
.container { box-shadow: none; border: none; width: 100%; display: flex; min-height: 270mm; }
.footer-wrap { position: relative; page-break-inside: avoid; }
}
</style>
</head>
<body>

<input type="file" id="fileInput" style="display: none;" accept="image/*" onchange="loadLogo(event)">

<div class="no-print">
<button onclick="saveAndPrint()" style="background: #27ae60;">üñ®Ô∏è DRUCKEN</button>
<button onclick="toggleType()" id="typeBtn" style="background: #8e44ad;">ZU ANGEBOT</button>
<button onclick="addItem()" style="background: #2ecc71;">+ POSITION</button>
<button onclick="saveProduct()" style="background: #f39c12;">üíæ PROD. SICHERN</button>
<button onclick="document.body.classList.toggle('compact')" style="background: #34495e;">üìè KOMPAKT-MODUS</button>
<button onclick="manageShipping()" style="background: #57606f;">‚öôÔ∏è VERSAND-OPTS</button>

<div class="smart-paste-area">
<textarea id="adrPaste" placeholder="eBay Adresse hier reinkopieren..."></textarea>
<button onclick="parseAddress()" style="width: auto; background: #00a8ff;">IMPORT</button>
</div>

<div class="shipping-ctrl" style="grid-column: span 3; display: flex; gap: 10px; background: rgba(255,255,255,0.05); padding: 10px; border-radius: 6px;">
<select id="shipSelect" style="flex:1; background:#2c3135; color:white; border:none; padding:5px;"></select>
<button onclick="addShipping()" style="width: auto; background: #2980b9;">+ VERSAND</button>
</div>
</div>

<div class="container" id="invoiceWrap">
<div class="header-main">
<div class="addr-left">
<h2>D3D</h2>
Graf-Sempt-Str. 27, 85661 Forstinning<br>Deutschland
</div>
<div class="title-center" id="docType">Rechnung</div>
<div class="logo-column">
<div class="logo-placeholder" onclick="document.getElementById('fileInput').click()">
<div id="logoContainer"><div style="font-size:30px; font-weight:bold;">D3D</div></div>
</div>
<div class="meta-box">
<div class="meta-row"><span>Datum:</span><input type="text" id="date"></div>
<div id="invMeta">
<div class="meta-row"><span>Rechnungsnr.:</span><input type="text" id="invNum" value="J012601"></div>
<div class="meta-row"><span>Zahlungsziel:</span><input type="number" id="dueDays" value="14" oninput="calcDate()"></div>
<div class="meta-row"><span>F√§llig am:</span><input type="text" id="dueDate" readonly></div>
</div>
</div>
</div>
</div>

<div class="recipient">
<strong>Empf√§nger:</strong>
<input type="text" id="rec-name" placeholder="Name">
<input type="text" id="rec-street" placeholder="Stra√üe">
<input type="text" id="rec-city" placeholder="PLZ Ort">
<input type="text" id="rec-tel" placeholder="Handynummer (optional)">
</div>

<p style="font-size: 11px;" id="introText">Wir danken f√ºr Ihren Auftrag und berechnen diesen wie folgt:</p>

<table>
<thead>
<tr>
<th style="width:5%">Pos.</th>
<th style="width:50%">Bezeichnung / Interne Notiz</th>
<th style="width:10%">Anz.</th>
<th style="width:10%">Einheit</th>
<th style="width:12%">Preis (‚Ç¨)</th>
<th style="width:13%">Gesamt</th>
</tr>
</thead>
<tbody id="itemsBody"></tbody>
</table>

<div class="summary-area">
<div class="total-box">Gesamtbetrag: <span id="grandTotal">0.00</span> ‚Ç¨</div>
<select id="statusSelect" class="no-print" onchange="updateStatus()">
<option value="">Zahlstatus...</option>
<option value="Betrag in bar erhalten">Bar erhalten</option>
<option value="Betrag dankend erhalten">Dankend erhalten</option>
<option value="Offen">Offen</option>
</select>
<div id="statusLabel"></div>
</div>

<div class="footer-wrap">
<div class="legal">
Die gelieferte Ware bleibt bis zur vollst√§ndigen Bezahlung Eigentum von D3D.<br>
Kein Steuerausweis aufgrund der Anwendung der Kleinunternehmerregelung (¬ß 19 UStG).<br>
Personalisierte und individuell angefertigte Waren sind vom Umtausch ausgeschlossen (¬ß312 Abs. 2 Nr. 1 BGB).
</div>
<div class="bottom-line">
<div><strong>D3D</strong><br>Graf-Sempt-Str. 27<br>85661 Forstinning</div>
<div><strong>Kontaktinformation</strong><br>kontakt.D3D@gmail.com<br>Gesch√§ftsf√ºhrer: Dominic Strzoda</div>
<div><strong>Steuerinformation</strong><br>St-Nr: 112/279/00204<br>DE455897359-00001</div>
<div><strong>Bankverbindung</strong><br>DE65 1001 1001 2856 6428 24<br>NTSBDEB1XXX</div>
</div>
</div>
</div>

<datalist id="prodList"></datalist>

<script>
let products = JSON.parse(localStorage.getItem('d3d_prods')) || ["Akkuhalter"];
let shippingOptions = JSON.parse(localStorage.getItem('d3d_shipping')) || [{name: "Versand (DHL Paket)", price: 5.49}];
let isInvoice = true;

function init() {
document.getElementById('date').value = new Date().toLocaleDateString('de-DE');
const lastNum = localStorage.getItem('d3d_last_inv');
if(lastNum) document.getElementById('invNum').value = incrementInvNum(lastNum);
const savedLogo = localStorage.getItem('d3d_logo');
if(savedLogo) document.getElementById('logoContainer').innerHTML = `<img src="${savedLogo}" class="logo-img-upload">`;
updateDatalist();
updateShippingList();
calcDate();
addItem();
}

function parseAddress() {
const raw = document.getElementById('adrPaste').value;
const lines = raw.split('\n').map(l => l.trim()).filter(l => l !== "");
if(lines.length >= 3) {
document.getElementById('rec-name').value = lines[0];
document.getElementById('rec-street').value = lines[1];
document.getElementById('rec-city').value = lines[2];
if(lines[3]) document.getElementById('rec-tel').value = lines[3];
}
}

function addItem(name = "", price = "") {
const body = document.getElementById('itemsBody');
const row = body.insertRow();
row.innerHTML = `
<td style="text-align:center">${body.rows.length}</td>
<td>
<input class="table-input prod-name" list="prodList" placeholder="Bezeichnung..." value="${name}">
<input class="internal-note" placeholder="Interne Notiz (Material, Zeit...) - wird nicht gedruckt">
</td>
<td><input type="number" class="table-input" value="${name ? 1 : ''}" placeholder="1" oninput="calc()"></td>
<td><input class="table-input" value="${name ? 'St√ºck' : ''}" placeholder="St√ºck"></td>
<td><input type="number" class="table-input" value="${price}" placeholder="0.00" step="0.01" oninput="calc()"></td>
<td style="font-weight:bold">
<span class="row-total"></span>
<div class="row-controls no-print">
<button class="btn-row btn-check" title="Als personalisiert markieren" onclick="markPersonalized(this)">‚úì</button>
<button class="btn-row btn-del" title="L√∂schen" onclick="this.closest('tr').remove(); calc();">‚úï</button>
</div>
</td>
`;
calc();
}

function markPersonalized(btn) {
const input = btn.closest('tr').querySelector('.prod-name');
if(!input.value.includes('(Personalisierte Anfertigung)')) {
input.value += " (Personalisierte Anfertigung)";
}
}

function addShipping() {
const sel = document.getElementById('shipSelect');
const opt = shippingOptions[sel.selectedIndex];
if(opt) addItem(opt.name, opt.price);
}

function calc() {
let total = 0;
const rows = document.getElementById('itemsBody').rows;
for (let i = 0; i < rows.length; i++) {
rows[i].cells[0].innerText = i + 1;
const q = rows[i].cells[2].querySelector('input').value || 0;
const p = rows[i].cells[4].querySelector('input').value || 0;
const sub = q * p;
rows[i].querySelector('.row-total').innerText = sub > 0 ? sub.toFixed(2) : "";
total += parseFloat(sub);
}
document.getElementById('grandTotal').innerText = total.toFixed(2);
}

function incrementInvNum(oldNum) {
return oldNum.replace(/(\d+)(?!.*\d)/, (m) => (parseInt(m) + 1).toString().padStart(m.length, '0'));
}

function saveAndPrint() {
localStorage.setItem('d3d_last_inv', document.getElementById('invNum').value);
window.print();
}

function updateShippingList() {
const sel = document.getElementById('shipSelect');
sel.innerHTML = shippingOptions.map((o, i) => `<option value="${i}">${o.name} (${o.price.toFixed(2)} ‚Ç¨)</option>`).join('');
}

function toggleType() {
isInvoice = !isInvoice;
document.getElementById('docType').innerText = isInvoice ? "Rechnung" : "Angebot";
document.getElementById('typeBtn').innerText = isInvoice ? "ZU ANGEBOT" : "ZU RECHNUNG";
}

function updateStatus() { document.getElementById('statusLabel').innerText = document.getElementById('statusSelect').value; }
function loadLogo(e) {
const r = new FileReader();
r.onload = () => { localStorage.setItem('d3d_logo', r.result); document.getElementById('logoContainer').innerHTML = `<img src="${r.result}" class="logo-img-upload">`; };
r.readAsDataURL(e.target.files[0]);
}
function updateDatalist() { document.getElementById('prodList').innerHTML = products.map(p => `<option value="${p}">`).join(''); }

init();
</script>
</body>
</html>

